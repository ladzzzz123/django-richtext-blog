{% extends 'blog-base.html' %}
{% load macros %}
{% loadmacros blog-macros.html %}

{# Javascript (jquery) to allow the page to be auto-scrolled to the form
   or comments section if there are user messages there #}
{% block page_javascript %}
  <script type="text/javascript" src="{{ STATIC_URL }}jquery-1.7.2.min.js"></script>
  <script type="text/javascript">
    $(document).ready(function() {
        var jumpTo = $('#jump-to-me');

        if (jumpTo) {
            offset = jumpTo.offset();
            if (offset) {
                window.scrollTo(0, offset.top);
            }
        }
    });
  </script>
{% endblock %}

{% block page_css %}
  <link rel="stylesheet" href="{{ STATIC_URL }}pygments.css" />
{% endblock %}

{# clear default messages section since on this template we want them
    appearing at the bottom of the page near the comments #}
{% block messages_section %}
{% endblock %}

{% block content %}
<div id="posts">
  <ul>
    {% usemacro blog_post %}
  </ul>
</div>
<div id="comments">
  <a name="comment-section">&nbsp;</a>

  {% if messages %}
    <ul class="messages" id="jump-to-me">
      {% for message in messages %}
	<li {% if message.tags %}class="{{ message.tags }}"{% endif %}>
	  {{ message }}
	</li>
      {% endfor %}
    </ul>
  {% endif %}

  <ul>
    {% for comment in comments %}
    <li class="comment">
      <span class="name">{% if comment.name %}{{ comment.name }}{% else %}Anonymous{% endif %}</span>
      <span class="created">{{ comment.created }}</span>
      <div class="message">{{ comment.comment }}</span>
    </li>
    {% endfor %}
  </ul>
  <form method="POST" action="">
    {% if form.errors %}
      <div class="errors" id="jump-to-me">
        {% if form.non_field_errors %}
          Please correct the following: {{ form.non_field_errors }}
        {% else %}
          <p>There was a problem with your submission. Please correct the errors below.</p>
        {% endif %}
      </div>
    {% endif %}

    <ul class="form-fields">
      {% for field in form %}
	<li class="{{ field.css_classes }}">
	  <div class="field-label">
	    <label for="id_{{ field.name }}">{{ field.label }}</label>:
	    {{ field.errors }}
	    <p class="page-help">
	      {{ field.help_text }}
	    </p>
	  </div>
	  <div class="field-input">
	    {{ field }}
	  </div>
	</li>
      {% endfor %}
    </ul>
    <div class="form-button">
      <input type="submit" value="Submit Comment" />
    </div>
    {% csrf_token %}
  </form>
</div>
{% endblock %}
